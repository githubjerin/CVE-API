const router = require('express').Router();
const cveMetadata = require('../models/cve-metadata');

const CVE = require('../models/cve-model');
const { sortBy } = require('../configurations/config');

router.get('/list', async (req, res) => {
  const cve = await CVE.aggregate([
    {$sort: sortBy(req.query.sortMode)},
    {$skip: (parseInt(req.query.page) - 1) * parseInt(req.query.limit)},
    {$limit: parseInt(req.query.limit)},
  ])

  const meta = await cveMetadata.findOne({ info: "Metadata" });
  res.render('cvelist', {data : cve, page: req.query.page, limit: req.query.limit, sortmode: req.query.sortMode, totalRecords: meta.cve.total});
});

router.get('/:cveId', async (req, res) => {
  CVE.findOne({id: req.params.cveId}).then((cve) =>{
    res.render('cvedetail', {data: cve});
  });
  
});

module.exports = router;